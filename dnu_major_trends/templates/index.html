{% extends "base.html" %}

{% block title %}Trang chủ - DNU Major Trends{% endblock %}
{% block page_title %}Trang chủ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="welcome-banner">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="bi bi-graph-up-arrow text-primary"></i>
                        Chào mừng đến với DNU Major Trends
                    </h1>
                    <p class="lead">
                        Hệ thống phân tích và dự báo xu hướng chọn ngành nghề tại Đại học Đại Nam
                    </p>
                    <p class="text-muted">
                        Sử dụng công nghệ AI và Machine Learning để giúp sinh viên đưa ra quyết định đúng đắn về ngành học phù hợp
                    </p>
                </div>
                <div class="col-md-4 text-center">
                    <img src="https://via.placeholder.com/300x200/0d6efd/ffffff?text=DNU+Analytics" 
                         alt="Analytics" class="img-fluid rounded shadow">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4 g-4">
    <!-- Feature Cards -->
    <div class="col-md-6 col-lg-3">
        <div class="feature-card">
            <div class="feature-icon bg-primary">
                <i class="bi bi-speedometer2"></i>
            </div>
            <h5 class="mt-3">Dashboard Thống kê</h5>
            <p class="text-muted">Xem tổng quan về xu hướng chọn ngành qua các năm với biểu đồ trực quan</p>
            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary btn-sm">
                Xem ngay <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>

    <div class="col-md-6 col-lg-3">
        <div class="feature-card">
            <div class="feature-icon bg-success">
                <i class="bi bi-graph-up"></i>
            </div>
            <h5 class="mt-3">Dự báo xu hướng</h5>
            <p class="text-muted">Dự đoán số lượng sinh viên chọn ngành trong 5 năm tới bằng AI</p>
            <a href="{{ url_for('forecast_page') }}" class="btn btn-outline-success btn-sm">
                Dự báo <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>

    <div class="col-md-6 col-lg-3">
        <div class="feature-card">
            <div class="feature-icon bg-info">
                <i class="bi bi-chat-dots"></i>
            </div>
            <h5 class="mt-3">Tư vấn ngành học</h5>
            <p class="text-muted">Chatbot AI giúp tư vấn ngành học phù hợp dựa trên sở thích và năng lực</p>
            <a href="{{ url_for('chat_page') }}" class="btn btn-outline-info btn-sm">
                Tư vấn <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>

    {% if current_user.role == 'admin' %}
    <div class="col-md-6 col-lg-3">
        <div class="feature-card">
            <div class="feature-icon bg-warning">
                <i class="bi bi-file-earmark-text"></i>
            </div>
            <h5 class="mt-3">Báo cáo & Export</h5>
            <p class="text-muted">Xuất báo cáo chi tiết dưới dạng Excel và PDF cho quản lý</p>
            <a href="{{ url_for('reports_page') }}" class="btn btn-outline-warning btn-sm">
                Báo cáo <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- Quick Stats -->
<div class="row mt-5">
    <div class="col-12">
        <h3 class="mb-4"><i class="bi bi-bar-chart"></i> Thống kê nhanh</h3>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon text-primary">
                <i class="bi bi-people"></i>
            </div>
            <div class="stat-content">
                <h3 id="totalStudents" class="mb-0">---</h3>
                <p class="text-muted mb-0">Tổng sinh viên</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon text-success">
                <i class="bi bi-book"></i>
            </div>
            <div class="stat-content">
                <h3 id="totalMajors" class="mb-0">---</h3>
                <p class="text-muted mb-0">Số ngành</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon text-info">
                <i class="bi bi-calendar-range"></i>
            </div>
            <div class="stat-content">
                <h3 id="yearRange" class="mb-0">---</h3>
                <p class="text-muted mb-0">Năm dữ liệu</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon text-warning">
                <i class="bi bi-trophy"></i>
            </div>
            <div class="stat-content">
                <h3 id="topMajor" class="mb-0">---</h3>
                <p class="text-muted mb-0">Ngành HOT nhất</p>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Hướng dẫn sử dụng</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fw-bold">Cho sinh viên:</h6>
                        <ol>
                            <li>Truy cập <strong>Dashboard</strong> để xem xu hướng các ngành</li>
                            <li>Sử dụng <strong>Dự báo</strong> để xem triển vọng ngành trong tương lai</li>
                            <li>Chat với <strong>Chatbot</strong> để được tư vấn ngành phù hợp</li>
                            <li>So sánh nhiều ngành để đưa ra quyết định tốt nhất</li>
                        </ol>
                    </div>
                    {% if current_user.role == 'admin' %}
                    <div class="col-md-6">
                        <h6 class="fw-bold">Cho quản trị viên:</h6>
                        <ol>
                            <li>Upload dữ liệu CSV/Excel từ menu <strong>Upload dữ liệu</strong></li>
                            <li>Xem phân tích chi tiết trong <strong>Dashboard</strong></li>
                            <li>Tạo báo cáo từ menu <strong>Báo cáo</strong></li>
                            <li>Export dữ liệu dưới dạng Excel hoặc PDF</li>
                        </ol>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Load quick stats
async function loadQuickStats() {
    try {
        const response = await fetch('/api/overview');
        const data = await response.json();
        
        document.getElementById('totalStudents').textContent = 
            data.total_students.toLocaleString('vi-VN');
        document.getElementById('totalMajors').textContent = data.total_majors;
        
        if (data.years && data.years.length > 0) {
            const minYear = Math.min(...data.years);
            const maxYear = Math.max(...data.years);
            document.getElementById('yearRange').textContent = 
                minYear === maxYear ? minYear : `${minYear}-${maxYear}`;
        }
        
        if (data.top_majors && data.top_majors.length > 0) {
            document.getElementById('topMajor').textContent = data.top_majors[0].major;
        }
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

// Load on page ready
document.addEventListener('DOMContentLoaded', loadQuickStats);
</script>
{% endblock %}
