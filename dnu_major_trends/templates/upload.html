{% extends "base.html" %}

{% block title %}Upload dữ liệu - DNU Major Trends{% endblock %}
{% block page_title %}Upload dữ liệu{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-cloud-upload"></i> Upload dữ liệu ngành
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6 class="alert-heading"><i class="bi bi-info-circle"></i> Định dạng file</h6>
                    <p class="mb-0">
                        Hỗ trợ file <strong>CSV, XLSX, XLS</strong>. 
                        File phải chứa các cột: <code>year</code>, <code>major</code>, <code>students</code>, 
                        <code>male</code>, <code>female</code>, <code>region</code>, <code>avg_score</code>
                    </p>
                </div>

                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    <div class="mb-4">
                        <label for="file" class="form-label">Chọn file dữ liệu</label>
                        <input type="file" class="form-control" id="file" name="file" 
                               accept=".csv,.xlsx,.xls" required>
                        <div class="form-text">
                            Dung lượng tối đa: 16MB
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-upload"></i> Upload dữ liệu
                        </button>
                    </div>
                </form>

                <div id="uploadProgress" class="mt-3" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 100%"></div>
                    </div>
                    <p class="text-center mt-2 text-muted">Đang xử lý dữ liệu...</p>
                </div>
            </div>
        </div>

        <!-- Sample Data -->
        <div class="card mt-4">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-table"></i> Dữ liệu mẫu</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>year</th>
                                <th>major</th>
                                <th>students</th>
                                <th>male</th>
                                <th>female</th>
                                <th>region</th>
                                <th>avg_score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2023</td>
                                <td>Công nghệ thông tin</td>
                                <td>450</td>
                                <td>350</td>
                                <td>100</td>
                                <td>Bắc</td>
                                <td>24.5</td>
                            </tr>
                            <tr>
                                <td>2023</td>
                                <td>Quản trị kinh doanh</td>
                                <td>320</td>
                                <td>150</td>
                                <td>170</td>
                                <td>Trung</td>
                                <td>22.0</td>
                            </tr>
                            <tr>
                                <td>2024</td>
                                <td>Dược học</td>
                                <td>280</td>
                                <td>100</td>
                                <td>180</td>
                                <td>Nam</td>
                                <td>25.5</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-muted mb-0">
                    <small>
                        <i class="bi bi-lightbulb"></i>
                        Có thể sử dụng tiếng Việt có dấu cho tên cột: 
                        năm, ngành, số lượng sinh viên, nam, nữ, khu vực, điểm chuẩn
                    </small>
                </p>
            </div>
        </div>

        <!-- Available Files -->
        <div class="card mt-4">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-files"></i> File dữ liệu có sẵn</h6>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-file-earmark-spreadsheet text-success"></i>
                                <strong>du_lieu_2023_chi_tiet.csv</strong>
                                <p class="mb-0 text-muted small">Dữ liệu chi tiết năm 2023</p>
                            </div>
                            <span class="badge bg-secondary">CSV</span>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-file-earmark-spreadsheet text-success"></i>
                                <strong>du_lieu_chon_nganh_2020_2024.csv</strong>
                                <p class="mb-0 text-muted small">Dữ liệu tổng hợp 2020-2024</p>
                            </div>
                            <span class="badge bg-secondary">CSV</span>
                        </div>
                    </div>
                </div>
                <div class="alert alert-warning mt-3 mb-0">
                    <small>
                        <i class="bi bi-exclamation-triangle"></i>
                        Các file này nằm trong thư mục <code>sample_data/</code>. 
                        Bạn có thể upload trực tiếp hoặc import từ code.
                    </small>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card mt-4">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-book"></i> Hướng dẫn</h6>
            </div>
            <div class="card-body">
                <ol>
                    <li class="mb-2">Chuẩn bị file CSV hoặc Excel với các cột theo định dạng mẫu</li>
                    <li class="mb-2">Click "Chọn file" và chọn file từ máy tính</li>
                    <li class="mb-2">Nhấn "Upload dữ liệu" để bắt đầu import</li>
                    <li class="mb-2">Hệ thống sẽ tự động validate và xử lý dữ liệu</li>
                    <li class="mb-2">Sau khi upload thành công, dữ liệu sẽ xuất hiện trong Dashboard</li>
                </ol>
                
                <h6 class="mt-4">Lưu ý:</h6>
                <ul>
                    <li>Nếu dữ liệu đã tồn tại (cùng năm, ngành, khu vực), nó sẽ được cập nhật</li>
                    <li>Dữ liệu mới sẽ được thêm vào database</li>
                    <li>Hệ thống hỗ trợ cả tiếng Việt có dấu</li>
                    <li>File phải có đầy đủ các cột bắt buộc</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('uploadForm').addEventListener('submit', function(e) {
    const progress = document.getElementById('uploadProgress');
    progress.style.display = 'block';
});

// File size validation
document.getElementById('file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const maxSize = 16 * 1024 * 1024; // 16MB
        if (file.size > maxSize) {
            alert('File quá lớn! Vui lòng chọn file nhỏ hơn 16MB.');
            e.target.value = '';
        }
    }
});
</script>
{% endblock %}
